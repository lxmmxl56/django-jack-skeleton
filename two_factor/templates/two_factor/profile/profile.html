{% extends "account.base.html" %}
{% load i18n two_factor %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-auto">
      <h1 class="fs-2">{% block title %}{% trans "Account Security" %}{% endblock %}</h1>

      {% if default_device %}
      {% if default_device_type == 'TOTPDevice' %}
      <p>{% trans "Tokens will be generated by your token generator." %}</p>
      {% elif default_device_type == 'EmailDevice' %}
      <p>{% blocktrans with primary=default_device|device_action %}Primary method: {{ primary }}{% endblocktrans %}</p>
      {% endif %}

      <h2 class="fs-4">{% trans "Backup Email" %}</h2>
      <p>{% blocktrans trimmed %}If your primary method is not available, we can send backup tokens to the email addresses listed below.{% endblocktrans %}</p>
      <ul>
        {% for email in backup_emails %}
        <form method="post" action="{% url 'two_factor:email_delete' email.id %}" onsubmit="return confirm('Are you sure you want to remove this backup email address?')">
          <li>
            {{ email|device_action }}
            {% csrf_token %}
            <button class="btn btn-sm btn-danger d-inline rounded-pill py-0 px-1" type="submit">ãƒ¼</button>
          </li>
        </form>
        {% endfor %}
      </ul>
      <p><a href="{% url 'two_factor:email_create' %}" class="btn btn-primary">{% trans "Add Email Address" %}</a></p>

      <h2 class="fs-4">{% trans "Backup Tokens" %}</h2>
      <p>
        {% blocktrans trimmed %}If you can't access your primary or backup devices, you can access your account using backup tokens.{% endblocktrans %}
      </p>
      {% if backup_tokens %}
      <p>
        {% blocktrans trimmed count counter=backup_tokens %}
        You have only one backup token remaining.
        {% plural %}
        You have {{ counter }} backup tokens remaining.
        {% endblocktrans %}
      </p>
      <p><a href="{% url 'two_factor:backup_tokens' %}" class="btn btn-primary">
        {% trans "Show Backup Tokens" %}
      </a></p>
      {% else %}
      <p><a href="{% url 'two_factor:backup_tokens' %}" class="btn btn-primary">
        {% trans "Create Backup Tokens" %}
      </a></p>
      {% endif %}
    </p>

    <h2 class="fs-4">{% trans "Disable Two-Factor Authentication" %}</h2>
    <p>{% blocktrans trimmed %}You can disable two-factor authentication if you lose access to your tokens or wish to change your primary method.{% endblocktrans %}</p>
    <p><a class="btn btn-secondary" href="{% url 'two_factor:disable' %}">
    {% trans "Disable Two-Factor Authentication" %}</a></p>
    {% else %}
    <p>{% blocktrans trimmed %}Two-factor authentication is not enabled for your account. Enable two-factor authentication for enhanced account
    security.{% endblocktrans %}</p>
    <p><a href="{% url 'two_factor:setup' %}" class="btn btn-primary">
    {% trans "Enable Two-Factor Authentication" %}</a>
  </p>
  {% endif %}
</div>
</div>
<div class="row">
  <div class="col-auto">
    <a href="{% url 'profile' %}">Back to profile</a>
  </div>
</div>
</div>
{% endblock %}
